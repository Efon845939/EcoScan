{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile in the EcoScan Rewards system, including authentication details and app-specific data.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The unique identifier for the user, matching their Firebase Auth UID."
        },
        "username": {
          "type": "string",
          "description": "The user's unique, public-facing username."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "emailVerified": {
          "type": "boolean",
          "description": "Flag indicating if the user's email has been verified."
        },
        "phone": {
          "type": "string",
          "description": "User's phone number in E.164 format (e.g., +905301234567)."
        },
        "phoneVerified": {
          "type": "boolean",
          "description": "Flag indicating if the user's phone number has been verified."
        },
        "country": {
          "type": "string",
          "description": "User's country code (ISO 3166-1 alpha-2)."
        },
        "totalPoints": {
          "type": "number",
          "description": "The total number of points the user has accumulated."
        },
        "lastCarbonSurveyDate": {
          "type": "string",
          "description": "The date the user last completed the carbon footprint survey.",
          "format": "date-time"
        },
        "isDisabled": {
          "type": "boolean",
          "description": "Flag to disable a user's account."
        },
        "roles": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "An array of roles assigned to the user (e.g., 'user', 'admin')."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the user profile was created."
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the last profile update."
        }
      },
      "required": [
        "uid",
        "username",
        "email",
        "emailVerified",
        "country",
        "createdAt",
        "updatedAt",
        "totalPoints",
        "isDisabled",
        "roles"
      ]
    },
    "VerificationCode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VerificationCode",
      "type": "object",
      "description": "Represents a one-time password (OTP) for phone or email verification.",
      "properties": {
        "target": {
          "type": "string",
          "description": "The phone number or email address the code was sent to."
        },
        "type": {
          "type": "string",
          "enum": ["phone", "email", "passwordReset"],
          "description": "The purpose of the verification code."
        },
        "codeHash": {
          "type": "string",
          "description": "The SHA-256 hash of the 6-digit code."
        },
        "expiresAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the code is no longer valid."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the code was generated."
        },
        "consumed": {
          "type": "boolean",
          "description": "Flag indicating if the code has already been used."
        }
      },
      "required": ["target", "type", "codeHash", "expiresAt", "createdAt", "consumed"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership enforced by {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/verificationCodes/{codeId}",
        "definition": {
          "entityName": "VerificationCode",
          "schema": {
            "$ref": "#/backend/entities/VerificationCode"
          },
          "description": "Stores OTP codes for phone/email verification. Intended for server-side access only.",
          "params": [
            {
              "name": "codeId",
              "description": "The unique identifier for the verification code document."
            }
          ]
        }
      }
    ]
  }
}
